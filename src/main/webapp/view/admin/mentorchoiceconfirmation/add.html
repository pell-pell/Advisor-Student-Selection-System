<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>新增</title>
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="/static/css/xadmin.css">
</head>
<body style="padding: 10px;background: white;min-height: 90%">
<div id="divvuehtml" style="width: 90%;height: 100%;margin: auto;">
    <form class="layui-form" id="add">
        <table class="layui-table" lay-size="sm">
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center;">新增</th>
                </tr>
            </thead>
            <tbody style="text-align: center;">
            <tr>
                <td>请选择考生</td>
                <td colspan="3">
                    <select name="candidateId" lay-filter="candidateId">
                        <option value="">请选择</option>
                        <option v-for="(s,index) in hs" :value="s.id">{{s.name}}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>请选择导师</td>
                <td colspan="3">
                    <select name="mentorId" lay-filter="mentorId">
                        <option value="">请选择</option>
                        <option v-for="(s,index) in ds" :value="s.id">{{s.name}}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>学生选择的志愿顺序</td>
                <td colspan="3">
                    <input type="text" name="preferenceOrder"  placeholder="请输入学生选择的志愿顺序"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>是否确认选择</td>
                <td colspan="3">
                    <select name="confirmed"  required lay-verify="required">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </td>
            </tr>
            <tr >
                <td colspan="4">
                    <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">新增</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
</body>
<script src="/static/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/xadmin.js"></script>
<script type="text/javascript" src="/static/js/vue.js"></script>
<script th:inline="none">
    var ve = new Vue({
        el: '#divvuehtml',//绑定vue渲染范围
        data: {
            hs:[],
            ds:[]
        },created: function () {//vue在打开html也没初始化创建函数
            this.ininhs();
            this.ininds();
        },mounted: function () {//初始化html完成后在进行操作
            setTimeout(function() {
                layui.use(['table','form','layer','upload','laydate'],function() {
                    var form = layui.form;
                    var layer = layui.layer;
                    var laydate = layui.laydate;
                    laydate.render({
                        elem: '#resultTime' //指定元素
                        ,type: 'datetime'
                    });
                    //监听提交
                    form.on('submit(formDemo)', function(data){
                        var index;
                        $.ajax({
                            url : "/api/admin/mentorchoiceconfirmation/insert.do",
                            type : "POST",
                            data : data.field,
                            dataType : "json",
                            beforeSend : function(XMLHttpRequest) {
                                index = layer.msg('正在提交数据中，请稍候', {
                                    icon : 16,
                                    time : false,
                                    shade : 0.8
                                });
                            },success : function(data) {
                                if(data.success){
                                    // 刷新父页面
                                    layer.alert(data.msg, {
                                        icon : 6
                                    }, function() {
                                        xadmin.close();
                                        // 刷新父页面
                                        parent.location.reload();
                                    });
                                }else{
                                    xadmin.alert(data.msg,2)
                                }
                            },complete : function(XMLHttpRequest, textStatus) {
                                layer.close(index);
                            },error : function(data) {
                                layer.alert('网络异常或者数据错误', {
                                    icon : 2
                                });
                            }
                        });
                        return false;
                    });
                });
            },100)
        },methods: {//调用函数
            ininhs:function (){
                $.get("/api/admin/candidateinfo/list.do?page=1&rows=100",function(data){
                    if(data.success){
                        ve.hs = data.data.records;
                    }else{
                        xadmin.alert("初始化数据错误");
                    }
                },"json")
            }, ininds:function (){//这里如果是导师自己确认，只能看到他自己的，需要权限处理
                $.get("/api/admin/mentor/list.do?page=1&rows=100",function(data){
                    if(data.success){
                        ve.ds = data.data.records;
                    }else{
                        xadmin.alert("初始化数据错误");
                    }
                },"json")
            }
        },updated: function () {
            layui.use(['form'], function(){
                var form = layui.form;
                form.render();
            })
        }
    })
</script>
</html>
