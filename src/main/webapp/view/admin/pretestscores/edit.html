<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>修改</title>
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="/static/css/xadmin.css">
</head>
<body style="padding: 10px;background: white;min-height: 90%">
<div id="divvuehtml" style="width: 90%;height: 100%;margin: auto;">
    <form class="layui-form" id="add">
        <input type="hidden" name="id" :value="menuItems.id">
        <table class="layui-table" lay-size="sm">
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center;">修改</th>
                </tr>
            </thead>
            <tbody style="text-align: center;">
            <tr>
                <td>请选择考生</td>
                <td colspan="3">
                    <select name="candidateId" lay-filter="candidateId" :value="menuItems.candidateId">
                        <option value="">请选择</option>
                        <option v-for="(s,index) in hs" :value="s.id">{{s.name}}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>初试数学成绩</td>
                <td colspan="3">
                    <input type="text" name="shuxueScore" :value="menuItems.shuxueScore"  placeholder="请输入初试数学成绩"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>初试外语成绩</td>
                <td colspan="3">
                    <input type="text" name="foreignLanguageScore" :value="menuItems.foreignLanguageScore" placeholder="请输入初试外语成绩"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>初试政治成绩</td>
                <td colspan="3">
                    <input type="text" name="comprehensiveScore" :value="menuItems.comprehensiveScore" placeholder="请输入初试政治成绩"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>初试专业成绩</td>
                <td colspan="3">
                    <input type="text" name="retestMajorScore" :value="menuItems.retestMajorScore" placeholder="请输入初试专业成绩"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>初试总成绩</td>
                <td colspan="3">
                    <input type="text" name="retestTotalScore" :value="menuItems.retestTotalScore" placeholder="请输入初试总成绩"  autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr >
                <td colspan="4">
                    <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">修改</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
</body>
<script src="/static/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/xadmin.js"></script>
<script type="text/javascript" src="/static/js/vue.js"></script>
<script th:inline="none">
    var ve = new Vue({
        el: '#divvuehtml',//绑定vue渲染范围
        data: {
            hs:[],
            menuItems:{}//初始化菜单资源对象
        },created: function () {//vue在打开html也没初始化创建函数
            this.ininhs();
            this.inin();
        },mounted: function () {//初始化html完成后在进行操作
            layui.use(['form','layer','laydate'], function(){
                var form = layui.form;
                var layer = layui.layer;
                var laydate = layui.laydate;
                //监听提交
                form.on('submit(formDemo)', function(data){
                    var index;
                    $.ajax({
                        url : "/api/admin/pretestscores/updates.do",
                        type : "POST",
                        data : data.field,
                        dataType : "json",
                        beforeSend : function(XMLHttpRequest) {
                            index = layer.msg('正在提交数据中，请稍候', {
                                icon : 16,
                                time : false,
                                shade : 0.8
                            });
                        },success : function(data) {
                            if(data.success){
                                // 刷新父页面
                                layer.alert(data.msg, {
                                    icon : 6
                                }, function() {
                                    xadmin.close();
                                    // 刷新父页面
                                    parent.location.reload();
                                });
                            }else{
                                xadmin.alert(data.msg,2)
                            }
                        },complete : function(XMLHttpRequest, textStatus) {
                            layer.close(index);
                        },error : function(data) {
                            layer.alert('网络异常或者数据错误', {
                                icon : 2
                            });
                        }
                    });
                    return false;
                });
            });
        },methods: {//调用函数
            ininhs:function (){
                $.get("/api/admin/candidateinfo/list.do?page=1&rows=100",function(data){
                    if(data.success){
                        ve.hs = data.data.records;
                    }else{
                        xadmin.alert("初始化数据错误");
                    }
                },"json")
            },
            inin :function (){
                setTimeout(function() {
                    $.get("/api/admin/pretestscores/getById.do",{"id":getUrlParam("id")},function(data){
                        if(data.success){
                            ve.menuItems = data.data;
                        }else{
                            xadmin.alert("初始化数据错误");
                        }
                    },"json")
                }, 100);
            }
        },updated: function () {
            layui.use(['form'], function(){
                var form = layui.form;
                form.render();
            })
        }
    })

    /**
     * 取得url参数
     */
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // 构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  // 匹配目标参数
        if (r != null) return unescape(r[2]); return null; // 返回参数值
    }
</script>
</html>
